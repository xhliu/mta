%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   Author: Xiaohui Liu (whulxh@gmail.com)
%   Date:   9/28/2011
%   Function: prepares figures for loss causes only for MTA and other protocols
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
traffic = 'sparse';
dir = '/home/xiaohui/Dropbox/tOR/figures';
protocols = {'MTA'; 'MCMP'; 'MM'; 'MM-CD'; 'SDRCS'; 'CTP';};
PROTOCOL_NUM = 6;
CAUSE_NUM = 5;
results = zeros(PROTOCOL_NUM, CAUSE_NUM);
row = 1;
column = 1;
legends = {'Success', 'Overflow', 'Tx failure', 'Rejection', 'Expiration'};
%% MTA
% catch ratio 
t = [
0.940592831452313
0.974038941587619
0.965656195143122
0.958218121259207
0.958892312662903
0.940928272511475
0.965680157497288
0.93973217986859
0.959237187127533
0.946097153759424   
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.00037206994915
0.000249625561658
0.001728708078829
0.000125470514429
0
0
0.000237501484384
0.000583975706611
0.000715137067938
0.001083423618635    
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.01674314771177
0.009735396904643
0.007260573931082
0.014429109159348
0.009057129586623
0.012481463173505
0.0105688160551
0.014365802382621
0.010011918951132
0.013678223185265    
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.007689445615776
0.005491762356465
0.005762360262764
0.003513174404015
0.006038086391082
0.006549678695007
0.003918774492341
0.005722961924784
0.006793802145411
0.011646803900325    
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MCMP
% catch ratio 
t = [
0.214397728585814
0.115473441108545
0.011365236805589
0.001800115207373
0.234031390350374
0.004330708661417
0.05109022556391
0.023316703447651
0.050462802209787
0
0.000164609053498
0.070132369016067
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.333300952736783
0.353883778001778
0.742670502811916
0.771181363742873
0.409203213607412
0.707229099508535
0.750892259202259
0.591127674802516
0.386604584061064
0.514346599158435
0.89926812443773
0.594157395270999
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.1147007908338
0.030853312577886
0.110704577706914
0.098512848551121
0.092578355307312
0.078294403635787
0.073162994652245
0.135698093304113
0.111510893453733
0.095851877858673
0.082325142223166
0.125825410989733
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.004114826576997
0.013010433014771
0
0.117444739514176
0.186361261705983
0.011683467209216
0.000675870620344
0.045395992705829
0.267224303231467
0.270490490596188
0
0.092980076432673
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MMSPEED
% catch ratio 
t = [
0.134009661835749
0.013357079252004
0.128542611841727
0.082957610777011
0.006889797989317
0.026961161794149
0.084670760490745
0.083883458909702
0.041010806142101
0.091189663932641
0.031441179420319
0.12062885492089
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.488320916905444
0.46249995514318
0.494628562808195
0.483452090181747
0.506258369649731
0.547882289342931
0.431494142229868
0.449343219875927
0.470532286884929
0.551545198117654
0.455674279100853
0.494190207907022
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.053845272206304
0.083613111725265
0.065471756819189
0.093435761608758
0.122603439869595
0.113366420307002
0.056907198467997
0.069516955862373
0.083885652834282
0.106018785277664
0.072513733352894
0.125209280076537
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.010212034383954
0.051601234664735
0.004223984310915
0.007051755593114
0.001384480500409
0.002493396341063
0.000625353829319
0.003475847793119
0.004194282641714
0.001512589673222
0.003537255285507
0.004637380743575
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MMSPEEDCD
% catch ratio 
t = [
0.237027792651961
0.043981594658757
0.169090909090909
0.005011042761065
0.050623501878853
0.083928318511027
0.18688351140662
0.018981416423872
0.041677498555748
0.005317701664533
0.06449673687844
0.068504804921758
0.06745243869893
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.480884100771288
0.516687383660167
0.415640839971035
0.533553883053511
0.433981819003539
0.428207466504751
0.445980887689141
0.427279725019636
0.468418761277952
0.437176459712932
0.476069723282038
0.478986450598319
0.334747541767698
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.064725178069914
0.092210410443838
0.104614208705447
0.15040939541808
0.118534302869329
0.071044002259235
0.108094295944441
0.118720675273912
0.097794140679054
0.080208578439611
0.086630605520483
0.091123706171249
0.098293180182861
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.007191686452213
0.008757413282376
0.005209590473892
0.001389463237119
0.001379910394288
0.008421629447143
0.00036766767328
0.004014708825688
0.005931097389562
0.003308934754109
0.001195821241847
0.011069014614667
0.003950883003696
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% SDRCS
% catch ratio 
t = [
0.916708424236351
0.201854636849214
0.318661343048517
0.173375374382891
0.232964894242068
0.138439611784443
0.681302545404871
0.326455173653208
0.079646790222938
0.714818276179389
0.365654127628902
0.327961588041162
0.527676727189271
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.01368363437329
0.665512356367071
0.223541952185168
0.403114186851211
0.43070652173913
0.546716003700278
0.194682009018815
0.399060184348455
0.639728682170543
0.125526685393258
0.374540778839089
0.579531656548135
0.292616069898921
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.024630541871921
0.037934833936723
0.025887010811634
0.09996155324875
0.112577639751553
0.031267345050879
0.05815580780594
0.030182541116935
0.113759689922481
0.036692415730337
0.067597354886113
0.071639202081526
0.054822682885044
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0
0.011018416496144
0.209532511040049
0.107458669742407
0.168672360248447
0.00777058279371
0.003887420307884
0.000180733779143
0.012984496124031
0.006320224719101
0.004224834680382
0
0.013191708069214    
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% CTP
% catch ratio 
t = [
0.871259057915811
0.661773587308497
0.722262074254095
0.590802224067564
0.83562901278257
0.872791613801355
0.704711358072679
0.707985404183087
0.861874193159859
0.537249180437304
0.657674484169187
0.869430374059413
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.001658986175115
0.022202681908112
0.002111932418163
0.040085287846482
0
0.002141900937082
0.028911018310312
0.00695668305352
0.001414052143173
0.028538681948424
0.022530329289428
0.005235602094241
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0
0
0
0
0.000083118610257
0
0
0.000463778870235
0
0
0
0.000096955594338
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0
0
0
0
0
0
0
0
0
0
0
0
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% protocols
figure;
% title([metric 'for different protocols']);
h = bar(results * 100, 'stack');
set(h, 'linewidth', 2);
% color
colors = [
    128 0 0;
    0 0 143;
    100 0 0;
    0 255 0;
    60 0 0;
] / 255;
for i =1 : length(colors)
    set(h(i), 'facecolor', colors(i, :)) % use color name
end

set(gca, 'xtick', 1:size(protocols, 1), 'XTickLabel', protocols);
set(gca, 'FontSize', 30, 'YGrid', 'on', 'FontWeight', 'bold', 'ytick', 0:10:100);
h_legend = legend(legends);
set(h_legend, 'FontSize', 35);
ylabel('Ratio (%)');
ylim([0 100]);
%%
maximize;
set(gcf, 'Color', 'white');
cd(dir);
str = ['protocol_components_' traffic];
% export_fig(str, '-eps');
% export_fig(str, '-jpg', '-zbuffer');
% saveas(gcf, [str '.fig']);