%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   Author: Xiaohui Liu (whulxh@gmail.com)
%   Date:   9/28/2011
%   Function: prepares figures for loss causes only for MTA and other protocols
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
traffic = 'heavy';
dir = '/home/xiaohui/Dropbox/tOR/figures';
protocols = {'MTA'; 'MCMP'; 'MM'; 'MM-CD'; 'SDRCS'; 'CTP';};
PROTOCOL_NUM = 6;
CAUSE_NUM = 5;
results = zeros(PROTOCOL_NUM, CAUSE_NUM);
row = 1;
column = 1;
legends = {'Success', 'Overflow', 'Tx failure', 'Rejection', 'Expiration'};
%% MTA
% catch ratio 
t = [
0.91820632698985
0.93783456268711
0.93362116836509
0.90748905258628
0.92885687247038
0.92452656767602
0.91370455464968  
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0
0.010398348497592
0
0.002675840978593
0.005472430036021
0.008230452674897
0.004159616469261  
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.047760115606936
0.03287713127915
0.035850896272407
0.044954128440367
0.046411748406761
0.032852061100649
0.048505358150028    
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.009465317919075
0.006193134031654
0.006225155628891
0.012155963302752
0.004294818509282
0.008858199065355
0.005710659898477    
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MCMP
% catch ratio 
t = [
0.1987085584802
0.33300644504367
0.41959532325656
0.21964421991235
0.22528103698718
0.63378769376642
0.30799138977373
0.48952341450896
0.37397874020441
0.37134332568779
0.33060973898642
0.29459804095843
0.15384406115048
0.34851773937521
0.37188894840074
0.094804491735912
0.24058522166245
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.32135741459921
0.28576517833756
0.1253958652629
0.28423440217122
0.28103213262579
0.11865837017129
0.33565588770204
0.22245893564133
0.13795730523568
0.31716092381832
0.36400703313137
0.15647860364758
0.21256501564823
0.27540623864818
0.26565319303585
0.4543998326738
0.24920104209004
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.03021681777445
0.015663103922021
0.009925080804609
0.034368307777223
0.016251758487174
0.016783269749048
0.021737066917113
0.032186428929729
0.018586489864931
0.013376791654924
0.038801313970713
0.009405817705592
0.008323632451192
0.014277617025541
0.026156785333868
0.026319748546727
0.016849803027584
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.001027994831502
0.000197641689868
0.005271492333965
0.004600020734036
0.000268994623236
0.002579529786332
0.002301879529129
0.019275634688624
0.010862027496044
0.003344197913731
0.002727966656336
0.003984646409824
0.000302311105975
0.003766143073666
0.026262898053275
0.004708128932582
0.020471253230527
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MMSPEED
% catch ratio 
t = [
0.008485824204521
0.1198118760857
0.20430668819222
0.10571049129579
0.086842367849608
0.17668679080767
0.17467175872052
0.23719587035104
0.022137825607465
0.097686580409046
0.089346466569397
0.038770053038599
0.12368584795938
0.098511283845112
0.043057858849435
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.57923219891035
0.46283537206658
0.37511382470217
0.36959485201564
0.52439578846614
0.39113175523922
0.42560258081579
0.40254632292552
0.42457428849433
0.44962835379849
0.41532993579432
0.51253410926811
0.39563428665226
0.49062003349302
0.38046656528401
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.141592703191
0.04195476516897
0.03510886010876
0.034673767849912
0.03109319491229
0.041569690385857
0.041946642338394
0.026840525584268
0.034076891097071
0.037852077182385
0.036252767119555
0.038571461997507
0.021263112766777
0.050783088380977
0.042853667337291
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.037409602626573
0.01852807738995
0.044078276924866
0.051781374571384
0.004113056123106
0.035865116984252
0.002597315315071
0.013204799857398
0.13091866067991
0.031444733850684
0.078875529495259
0.038413382235222
0.032172522755784
0.008827024089493
0.021684622891835
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MMSPEEDCD
% catch ratio 
t = [
0.34867989424886
0.14148802649449
0.16631466680729
0.075279473950312
0.047142070458922
0.16943490966284
0.080117639047541
0.022770331270717
0.07136908962279
0.02324663021217
0.22027233808162
0.13108283175996
0.054967496451142
0.017131970108572
0.043593375046615
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.34109452824402
0.42271058693504
0.4830394010641
0.51157211147664
0.55003211071763
0.43475996778421
0.43562624035036
0.41713377549708
0.42379282920252
0.32065756301048
0.50189759549461
0.42365089039921
0.37223349941141
0.42936698225274
0.37918737833733
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.02635009205454
0.016430059150872
0.10643051852446
0.058813787422886
0.054170677570846
0.043143852050318
0.036976319476397
0.048016183115341
0.042279844262144
0.021816812699028
0.034627814157358
0.067928801618057
0.033321784138404
0.053438450848535
0.071072437593952
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.009208225653808
0.023671354002008
0.005357802715442
0.070717565272229
0.024042671506289
0.006572969356126
0.035993777771975
0.10977204618344
0.036313524775674
0.089820809555201
0.029107934870888
0.027668241839298
0.023308419712974
0.007958126987882
0.017737874385331
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% SDRCS
% catch ratio 
t = [
0.83223938566263
0.65468778891895
0.62019985998506
0.7363117717977
0.8241938776749
0.82837461671402
0.72103316969405
0.67055122685372
0.81040358140341
0.51865128403722
0.78050829559542
0.70896012023464
0.58184930575424
0.63503871635032
0.67191802145417
0.73052632472365
0.74084237022494
0.78327861224035
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.057968031830967
0.17523916014412
0.27910726956073
0.093591191417278
0.11173469387755
0.13266331658292
0.1507144395778
0.18786731095729
0.098366787183643
0.40547247436818
0.072673183170421
0.18760666929237
0.29213116891584
0.21040420075711
0.18187359054062
0.098680555555556
0.15984797674938
0.099670105987225
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.048363860876724
0.030749161386508
0.032703347739147
0.039172783738001
0.042419825072886
0.038316582914573
0.041861133050908
0.069413608462844
0.019511282882434
0.062757134460916
0.026632667516645
0.071090980701063
0.084816480865767
0.037306142386128
0.029743402206375
0.049444444444444
0.071540353230494
0.050607145363936
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0
0.040874642812772
0.000064503644456
0.000635234330887
0
0.000502512562814
0.003661951604796
0
0
0
0.015937101572461
0.000393855848759
0.007562422582958
0.000610575161802
0.009630035960261
0
0.000074521201282
0   
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% CTP
% catch ratio 
t = [
0.73461383311788
0.55059611713076
0.40361583165072
0.37374692607784
0.48100943790225
0.43854055307122
0.59357363452643
0.29897385020336
0.65080274013276
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.046330615270571
0.13901490602722
0.20206629904291
0.30148851533427
0.24406702121576
0.20153380793791
0.12840068827606
0.26491804361103
0.067677514792899
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0
0
0.00253533624897
0
0
0.000824956460631
0.000480553101118
0.000033013651145
0
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0
0
0
0
0
0
0
0
0
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% protocols
figure;
% title([metric 'for different protocols']);
h = bar(results * 100, 'stack');
set(h, 'linewidth', 2);
% color
colors = [
    128 0 0;
    0 0 143;
    100 0 0;
    0 255 0;
    60 0 0;
] / 255;
for i =1 : length(colors)
    set(h(i), 'facecolor', colors(i, :)) % use color name
end

set(gca, 'xtick', 1:size(protocols, 1), 'XTickLabel', protocols);
set(gca, 'FontSize', 30, 'YGrid', 'on', 'FontWeight', 'bold', 'ytick', 0:10:100);
h_legend = legend(legends);
set(h_legend, 'FontSize', 35);
ylabel('Ratio (%)');
ylim([0 100]);
%%
maximize;
set(gcf, 'Color', 'white');
cd(dir);
str = ['protocol_components_' traffic];
% export_fig(str, '-eps');
% export_fig(str, '-jpg', '-zbuffer');
% saveas(gcf, [str '.fig']);