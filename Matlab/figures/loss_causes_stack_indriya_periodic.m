%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   Author: Xiaohui Liu (whulxh@gmail.com)
%   Date:   9/28/2011
%   Function: prepares figures for loss causes only for MTA and other protocols
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
traffic = 'indriya_periodic';
dir = '/home/xiaohui/Dropbox/tOR/figures';
protocols = {'MTA'; 'MCMP'; 'MM'; 'MM-CD'; 'SDRCS'; 'CTP';};
PROTOCOL_NUM = 6;
CAUSE_NUM = 5;
results = zeros(PROTOCOL_NUM, CAUSE_NUM);
row = 1;
column = 1;
legends = {'Success', 'Overflow', 'Tx failure', 'Rejection', 'Expiration'};
%% MTA
% catch ratio 
t = [
0.96113876728886
0.91416485985902
0.90621242894776
0.95257988053686
0.96891537835108
0.97019603994432
0.90730368959541
0.95995577968106
0.90102020661665
0.945099627337  
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0
0.000324952272635
0.000120081655526
0
0.000080945442772
0
0
0
0.00195164695105
0   
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.00024313153416
0.004711807953207
0.003362286354721
0.00093450349423
0.000930872591873
0.001297542778363
0.000728892488358
0.000202445542149
0.002549089895248
0.000405153553197    
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.034281546316557
0.058328932937975
0.0806548452948
0.03567365512758
0.024040796503157
0.025423728813559
0.076938651548896
0.033565470888331
0.077309116979328
0.043959160521838    
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MCMP
% catch ratio 
t = [
0
0.40906105919856
0
0.73596476100733
0
0.043565762992778
0.33696109293621
0.87741239934881
0.71959122436672
0.68447708462256
0.50097661298498
0.71346301471456
0.77696083759656
0.37872561918741
0.08937295884171
0.2093159925753
0.35896524577046
0.73319866686379
0.69214245144293
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.79281045751634
0.46168404673826
0.78648201736255
0.10407053159119
0.79509071504803
0.65579818690979
0.29901874287954
0.00267413377742
0.083785156390968
0.14889244918492
0.07528974108981
0.03834408868157
0.056324498111048
0.075435210079344
0.29093580316966
0.13386732979671
0.045847792411462
0.05747392738285
0.086649691113286
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.20228758169935
0.069060009375032
0.21103761885076
0.062755249443856
0.16933475631448
0.16251744133707
0.067006174366885
0.001364740386407
0.021294491169925
0.027778704754529
0.021765356748276
0.006447451459782
0.011458686227528
0.012307672106177
0.009322375535477
0.010525686063283
0.005021265173708
0.013188196394626
0.015610890318817
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.000653594771242
0.001238127658118
0.000206696982224
0.000126863711814
0.00213447171825
0.066195093599435
0.048409747119688
0
0.000402366838967
0.000070414967692
0.00003065543204
0.000267630060595
0
0.002874044310508
0.020642402971412
0.005719241343329
0.000598910445337
0.000038750821923
0.000341532696127
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MMSPEED
% catch ratio 
t = [
0
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.27824827278805
0.31538092956397
0.52981802236352
0.48703075407683
0.44682485489928
0.46804528866848
0.4732251875109
0.38483791372416
0.44381612550164
0.40231576881562
0.32377410198688
0.38882008091817
0.26599702380952
0.42663200462161
0.40152359717577
0.4700345950346
0.055744310998736
0.083937476427943
0.20048869883934
0.54865872175954
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.00412302206374
0.024820316243412
0.068077176057882
0.084710517675386
0.036275179242062
0.047066529428277
0.030350601779173
0.055475197821833
0.04761036118205
0.058286723579629
0.036116276793579
0.035917760713401
0.036551339285714
0.035721163104179
0.024061687105165
0.15404965404965
0.01121997471555
0.011146963919038
0.064874770922419
0.055813739474532
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.71239135279697
0.65654048873982
0.38598991449244
0.42541315530262
0.49487879822465
0.46832600355572
0.49206349206349
0.52914149578831
0.47291134622401
0.48670395446963
0.62092590780072
0.54099578895219
0.57868303571429
0.53620258039669
0.561872909699
0.33770858770859
0.93295670037927
0.90240120688933
0.72738749745469
0.39281277320204
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MMSPEEDCD
% catch ratio 
t = [
0
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.080970350404313
0.2921028559813
0.26063891131357
0.23548578199052
0.48050682261209
0.44566778362853
0.58567629179331
0.4353881032063
0.36296296296296
0.46648703267093
0.32056356927206
0.14718789001168
0.38917145200984
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.01078167115903
0.030999085272894
0.069196171145197
0.067831753554502
0.10487329434698
0.023647678314983
0.050056990881459
0.077944510417791
0.06334750050597
0.037049511620074
0.02660181147266
0.001932444945449
0.032526661197703
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.90576819407008
0.66998678727513
0.65586437550456
0.66084123222749
0.34473684210526
0.50320727620871
0.33197188449848
0.45492820900356
0.5598461849828
0.47352269750384
0.62089902717209
0.85067836869439
0.57526661197703
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% SDRCS
% catch ratio 
t = [
0.10520438137424
0.15200017675298
0.22588571757068
0.37568277691536
0.18582913458677
0.59759605666777
0.34932221063608
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.51987050680956
0.58770067102693
0.4803954184687
0.25158544371143
0.36824264835358
0.17877213896458
0
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.075686537173476
0.013293128344517
0.10132598260539
0.027793147478187
0.028350061630569
0.020052792915531
0.011470281543274
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0
0.000467170644695
0.078893588707761
0.005873590125559
0.003213593942596
0.005407016348774
0.45568300312826   
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% CTP
% catch ratio 
t = [
0.3899924901668
0.43720033759329
0.40832357137398
0.50214502130206
0.40371696493928
0.28840977259886
0.21824975055222
0.17126880343172
0.36415180993619
0.33386242745824
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.0062826783606
0.003887510339123
0.007480877532151
0.077090724784592
0.070176377699864
0.10706072736564
0.067468772193675
0.13646504188239
0.052088533865868
0.062544719895618
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0
0
0
0
0
0.001618260795503
0
0
0.000041604260276
0
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0
0
0
0
0
0
0
0
0
0
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;


%% protocols
figure;
% title([metric 'for different protocols']);
h = bar(results * 100, 'stack');
set(h, 'linewidth', 2);
% color
colors = [
    128 0 0;
    0 0 143;
    100 0 0;
    0 255 0;
    60 0 0;
] / 255;
for i =1 : length(colors)
    set(h(i), 'facecolor', colors(i, :)) % use color name
end

set(gca, 'xtick', 1:size(protocols, 1), 'XTickLabel', protocols);
set(gca, 'FontSize', 30, 'YGrid', 'on', 'FontWeight', 'bold', 'ytick', 0:10:100);
h_legend = legend(legends);
set(h_legend, 'FontSize', 35);
ylabel('Ratio (%)');
ylim([0 100]);
%%
maximize;
set(gcf, 'Color', 'white');
cd(dir);
str = ['protocol_components_' traffic];
% export_fig(str, '-eps');
% export_fig(str, '-jpg', '-zbuffer');
% saveas(gcf, [str '.fig']);