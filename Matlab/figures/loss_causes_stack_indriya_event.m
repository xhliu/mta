%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   Author: Xiaohui Liu (whulxh@gmail.com)
%   Date:   9/28/2011
%   Function: prepares figures for loss causes only for MTA and other protocols
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
traffic = 'indriya_event';
dir = '/home/xiaohui/Dropbox/tOR/figures';
protocols = {'MTA'; 'MCMP'; 'MM'; 'MM-CD'; 'SDRCS'; 'CTP';};
PROTOCOL_NUM = 6;
CAUSE_NUM = 5;
results = zeros(PROTOCOL_NUM, CAUSE_NUM);
row = 1;
column = 1;
legends = {'Success', 'Overflow', 'Tx failure', 'Rejection', 'Expiration'};
%% MTA
% catch ratio 
t = [
0.92807336286492
0.95214626391097
0.92298029010761
0.92682577752996
0.90718920310083
0.91265997962366
0.90290142415819
0.91325688998807
0.96193455492847
0.90645551802885
0.96652719665272
0.93693132640526
0.95435559010562
0.94838842166091
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.010193968568597
0.000953895071542
0.001119820828667
0.00259385665529
0.001176470588235
0
0.007224194930819
0.001128349788434
0.006139489194499
0.002500367701133
0
0.001516070345664
0.003200667965488
0    
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.004389069800368
0.00302066772655
0.002737339803409
0.003959044368601
0.001176470588235
0.003168480506957
0.004407983347618
0.002397743300423
0.0012278978389
0.001617884983086
0.00164828198301
0.002728926622195
0.002783189535207
0.002629848783695 
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.042899617726179
0.032909379968204
0.046908050267513
0.059522184300341
0.071764705882353
0.069155531064885
0.061711766866658
0.061354019746121
0.024312377210216
0.072363582879835
0.02751363002409
0.051546391752577
0.021013080990816
0.034188034188034  
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MCMP
% catch ratio 
t = [
0.043876274841343
0.55268341686946
0.44941360587345
0.58566278868883
0.19360262314262
0.20664053139659
0.26458029425682
0.28746149978252
0.49511400651466
0.62837264451391
0.40899451703667
0.21383361262102
0.46343546152888
0.30792065077779
0.29829623938342
0.44774655731647
0.44205101688997
0.4721986447721
0.66201685382558
0.44385860787859
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.29335014203639
0.052916813998821
0.10957153826113
0.074946628713752
0.2936272930987
0.27475389183322
0.10578618980536
0.20377665204224
0.10376073437963
0.034454727668901
0.13615008516466
0.25530868864202
0.14813295419061
0.20914498751364
0.26060071297625
0.15046861986661
0.14022797948525
0.054518738407757
0.018651359928436
0.10057088022673
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.20587348193615
0.089010018586518
0.07345654119745
0.053702632983455
0.10503849075849
0.19945273847737
0.068384796338611
0.12629626451269
0.038377257921232
0.06346338548046
0.07705455441467
0.068912947700826
0.041789500362897
0.17204777705873
0.099475570662204
0.076416000665244
0.087133440403438
0.041912546850276
0.031353964771783
0.075056592878572
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.039237293848096
0.012886168910649
0.005928310838755
0.003099982209571
0.003870541590846
0.07196502630844
0.015270391415418
0.009644637947002
0.001421379923009
0.00649082611569
0.007193012096061
0.002425735759069
0.002296126393566
0.018737876709367
0.006903974112431
0.009883231576198
0.012985495086579
0.00170244387593
0.004696385593491
0.021798614433381
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MMSPEED
% catch ratio 
t = [
0.034570252246145
0.03102922842499
0.030540827147402
0.059712586719524
0.031788079470199
0.060789638604554
0.057971014492754
0.052382023726354
0.036334669673432
0.018177975058127
0.055555555555556
0.059011893870082
0.051702395964691
0.057072469718744
0.035192961407718
0.060969368572215
0.060560344827586
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.28596404302322
0.28332929075864
0.26892035378552
0.21113876908653
0.268929804885
0.22461221266326
0.19392111892203
0.24340259081617
0.29067066701394
0.2645001983807
0.27436567472497
0.27437161560859
0.28885599620208
0.3256258326755
0.2829187931258
0.26494583408891
0.25443078630033
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.15012402787888
0.17881836521533
0.17318034500203
0.13341897678474
0.12685368154953
0.14555173042197
0.12602601990835
0.1358273386251
0.12294505836471
0.14768140295316
0.13447646836586
0.12740964171484
0.13392259078796
0.12685121318297
0.14197756285068
0.13478349117895
0.14894802281332
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.41887157873199
0.44944846305081
0.4429490279793
0.50503472442034
0.50520291841724
0.4954792066696
0.55905596579162
0.49875798743135
0.40924127573645
0.50145360657324
0.45130206557128
0.46733907698212
0.4484015316561
0.44213189837558
0.47037984123683
0.46904654930276
0.47984056103828
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% MMSPEEDCD
% catch ratio 
t = [
0.044361525704809
0.00064892926671
0.01509900990099
0.010110736639384
0.032754010695187
0.005578202102553
0.008693552282057
0.037114261884904
0.03559083344002
0.00743123336291
0.023076923076923
0.039167182024325
0.075289980194587
0.082703423743886
0.001899134838574
0.003191489361702
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.25035745645802
0.27908299132518
0.26539781822494
0.31236030534986
0.24827847147582
0.2632615283139
0.26372611687613
0.23535492250958
0.26622285341277
0.25886106087124
0.27844242713808
0.24604139528152
0.20429661944775
0.23281705940436
0.30417652671272
0.23486744961216
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.14367038573546
0.17909217906396
0.14858243908223
0.16669193570918
0.14214009161827
0.13313746385073
0.15029382785382
0.11279322794316
0.18354404132408
0.18144218244006
0.16594043637522
0.15895932841222
0.10179393570922
0.14429144710807
0.15701471042521
0.15618289999462
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.47663543367089
0.48881302372824
0.5242405288433
0.45068824344799
0.51175766569505
0.53912454497581
0.52096586855014
0.54195452825808
0.42252378792671
0.48340241274721
0.45201692717221
0.47612402794774
0.35880368983669
0.36830895463148
0.48279181274751
0.51428327069958
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% SDRCS
% catch ratio 
t = [
0.34018076660669
0.033910262744052
0.42154637780125
0.42630536128563
0.22081944495216
0.35953281894928
0.1511482501392
0.052483072109076
0.45368571514243
0.33005873465582
0.34596254048062
0.49622197112633
0.49600320477042
0.27040640530806
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.34456650831354
0.41823519254015
0.085103626943005
0.1877800407332
0.2205303229194
0.17397318578421
0.2606554854593
0.36843754897352
0.073364276089235
0.25308021121448
0.17448660410717
0.1149725959143
0.10387323943662
0.36006357462794
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0.043052256532066
0.13762735278881
0.046502590673575
0.079226069246436
0.034523496980835
0.074483932751649
0.082705031543314
0.062059238363893
0.026201527174727
0.093915011315062
0.070719434244526
0.079970104633782
0.034834004024145
0.047536483167172
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0.006383610451306
0.005525815921257
0.00220207253886
0.00020366598778
0.001969020740352
0.002766546073633
0.016541006308663
0.005171603196991
0.010181164845037
0.013829519738496
0.055079559363525
0.015570503238665
0.034834004024145
0.040167605837307 
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;

%% CTP
% catch ratio 
t = [
0.73406494040538
0.86731244601666
0.47086582484942
0.93007538734943
0.25710845429636
0.22866040390304
0.25222014782655
0.30585245138116
0.57152157507172
0.78754502152508
0.67509752817559
0.31146787683834
0.79190769558596
0.47503034047467
];
results(row, column) = mean(t);
column = column + 1;

% overflow
t = [
0.009125840537944
0.0020337922403
0.093658536585366
0
0.11606391925988
0.15089237425635
0.10201408220075
0.14064935064935
0.007996632996633
0.002155172413793
0.012763339996924
0.096613705665222
0.017227999379171
0.088263511352734
];
results(row, column) = mean(t);
column = column + 1;

% air loss
t = [
0
0
0
0
0
0
0
0
0
0
0
0
0
0
];
results(row, column) = mean(t);
column = column + 1;

% rej
t = [
0
0
0
0
0
0
0
0
0
0
0
0
0
0
];
results(row, column) = mean(t);
column = column + 1;

% expire: either at on the way to sink or at sink
results(row, end) = 1 - sum(results(row, 1 : end - 1));
row = row + 1;
column = 1;


%% protocols
figure;
% title([metric 'for different protocols']);
h = bar(results * 100, 'stack');
set(h, 'linewidth', 2);
% color
colors = [
    128 0 0;
    0 0 143;
    100 0 0;
    0 255 0;
    60 0 0;
] / 255;
for i =1 : length(colors)
    set(h(i), 'facecolor', colors(i, :)) % use color name
end

set(gca, 'xtick', 1:size(protocols, 1), 'XTickLabel', protocols);
set(gca, 'FontSize', 30, 'YGrid', 'on', 'FontWeight', 'bold', 'ytick', 0:10:100);
h_legend = legend(legends);
set(h_legend, 'FontSize', 35);
ylabel('Ratio (%)');
ylim([0 100]);
%%
maximize;
set(gcf, 'Color', 'white');
cd(dir);
str = ['protocol_components_' traffic];
% export_fig(str, '-eps');
% export_fig(str, '-jpg', '-zbuffer');
% saveas(gcf, [str '.fig']);